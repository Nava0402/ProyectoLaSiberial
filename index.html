<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="iconos/fontawesome-free-7.1.0-web/css/all.css">
    <title>La Siberial</title>
    <style>
        :root{
            --accent:#d35400;
            --dark:#2c3e50;
            --muted:#7f8c8d;
            --bg:#f7f7f8;
            --card:#ffffff;
        }
        *{box-sizing:border-box}
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif; margin:0; background:var(--bg); color:var(--dark)}
        
        header{background:linear-gradient(90deg, #f39c12, var(--accent)); color:white; padding:20px 16px; display:flex; align-items:center; gap:16px; justify-content:space-between}
        header .left-side{display:flex; align-items:center; gap:16px}
        header img.logo{height:64px; width:64px; object-fit:cover; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,0.3);}
        header h1{font-size:1.6rem; margin:0}
        header p{margin:0; opacity:0.95}
        nav{display:flex; gap:16px; align-items:center;}
        nav a{color:white; text-decoration:none; padding:8px 16px; border-radius:6px; transition:background 0.2s;}
        nav a:hover{background:rgba(255,255,255,0.1);}
        .profile-icon{cursor:pointer; padding:8px 16px; color:white; border-radius:6px; display:flex; align-items:center; justify-content:center; transition:all 0.2s; font-size:20px;}
        .profile-icon:hover{background:rgba(255,255,255,0.1);}
        .profile-icon.filled{color:#ffdb58 !important;}

        .hero{background:#d35400; color:#fff; padding:35px 20px; border-bottom:6px solid #e67e22; min-height:320px;}
        .hero .inner{max-width:1100px; margin:0 auto; display:flex; gap:30px; align-items:center; background:#d35400;}
        .hero .left{flex:0 0 240px}
        .hero .left img{width:100%; max-width:240px; display:block; height:auto; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,0.25);}
        .hero .right{flex:1}
        .hero h2{font-size:2rem; margin:0 0 12px; line-height:1.2; font-weight:800}
        .hero p.lead{font-size:1.1rem; margin:0 0 16px; opacity:0.95; line-height:1.4;}
        .hero .cta{display:inline-block; background:#fff; color:#d35400; padding:12px 24px; border-radius:8px; text-decoration:none; font-weight:700; font-size:1rem; transition:all 0.3s; box-shadow:0 4px 12px rgba(0,0,0,0.2);}
        .hero .cta:hover{transform:translateY(-2px); box-shadow:0 6px 16px rgba(0,0,0,0.3);}

        .map-section{max-width:1100px; margin:24px auto; padding:0 16px}
        .map-container{background:#fff; border-radius:8px; padding:16px; margin-top:16px}
        .locations{display:grid; grid-template-columns:repeat(auto-fit, minmax(250px, 1fr)); gap:16px; margin-bottom:16px}
        .location-card{background:#f8f9fa; padding:12px; border-radius:6px; cursor:pointer; transition:background 0.2s}
        .location-card:hover{background:#e9ecef}
        .location-card h3{margin:0 0 4px; font-size:1rem}
        .location-card p{margin:0; font-size:0.9rem; color:#666}
        .map-frame, .map-frame-first, .map-frame-second{width:100%; height:400px; border:none; border-radius:6px}

        .reviews-section{max-width:1100px; margin:24px auto; padding:0 16px}
        .reviews-container{background:#fff; padding:16px; border-radius:8px}
        .review-form{display:flex; flex-direction:column; gap:8px; margin-top:12px}
        .review-form input, .review-form select, .review-form textarea{width:100%; padding:8px; border:1px solid #ddd; border-radius:6px}
        .review-form button{align-self:flex-start; padding:10px 14px; background:#d35400; color:#fff; border:none; border-radius:6px; cursor:pointer}
        .review-item{border-bottom:1px solid #f0f0f0; padding:10px 0; position:relative;}
        .review-item h4{margin:0 0 4px}
        .review-item .rating{color:#f1c40f}
        .delete-review-btn{position:absolute; top:10px; right:0; background:#e74c3c; color:#fff; border:none; padding:4px 6px; border-radius:3px; cursor:pointer; font-size:12px; line-height:1;}
        .delete-review-btn:hover{background:#c0392b;}

        .about-section{max-width:1100px; margin:24px auto; padding:0 16px}
        .about-box{background:#fff; padding:16px; border-radius:8px}

        .reviews-section{background:var(--bg); padding:40px 16px}
        .reviews-container{max-width:1000px; margin:0 auto}
        .review-form{display:flex; gap:12px; margin-top:20px; flex-wrap:wrap}
        .review-form input, .review-form select, .review-form textarea{padding:10px; border:1px solid #ccc; border-radius:6px}
        .review-form input{flex:1; min-width:200px}
        .review-form select{min-width:120px}
        .review-form textarea{width:100%; min-height:80px; resize:vertical}
        .review-form button{background:var(--accent); color:white; border:none; padding:10px 20px; border-radius:6px; cursor:pointer}
        .review-form button:hover{background:#e67e22}

        .delivery-section{background:linear-gradient(135deg, var(--accent), #e67e22); padding:50px 16px; color:white; text-align:center}
        .delivery-container{max-width:800px; margin:0 auto}
        .delivery-content{display:flex; justify-content:center; align-items:center; margin-top:30px}
        .delivery-info{text-align:center}
        .delivery-icon{font-size:4rem; margin-bottom:20px; opacity:0.9}
        .delivery-info h3{font-size:1.8rem; margin:10px 0; font-weight:600}
        .delivery-description{font-size:1.1rem; margin:15px 0; opacity:0.95}
        .phone-number{margin:25px 0}
        .phone-number a{color:white; text-decoration:none; background:rgba(255,255,255,0.15); padding:15px 30px; border-radius:50px; font-size:1.4rem; font-weight:700; display:inline-block; transition:all 0.3s ease; border:2px solid rgba(255,255,255,0.3)}
        .phone-number a:hover{background:rgba(255,255,255,0.25); transform:translateY(-2px); box-shadow:0 8px 20px rgba(0,0,0,0.2)}
        .phone-number i{margin-right:10px}
        .delivery-note{font-size:1.1rem; opacity:0.8; margin-top:20px}
        
        .profile-modal{display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:2000; justify-content:center; align-items:center; overflow-y:auto; padding:20px 0;}
        .profile-modal.active{display:flex;}
        .profile-content{background:#fff; border-radius:16px; padding:24px; max-width:500px; width:90%; max-height:90vh; overflow-y:auto; box-shadow:0 8px 32px rgba(0,0,0,0.2);}
        .profile-content h2{color:var(--accent); margin:0 0 12px; font-size:24px; text-align:center;}
        .form-group{margin-bottom:12px;}
        .form-group label{display:block; margin-bottom:5px; font-weight:600; color:var(--dark); font-size:13px;}
        .form-group input, .form-group select, .form-group textarea{width:100%; padding:8px 10px; border:2px solid #ddd; border-radius:8px; font-size:13px; font-family:inherit; transition:border-color 0.3s; box-sizing:border-box;}
        .phone-input-group{display:flex; gap:8px;}
        .phone-input-group .country-code-input{flex:0 0 80px; text-align:center;}
        .phone-input-group .phone-number-input{flex:1;}
        .form-group select{cursor:pointer;}
        .form-group input:focus, .form-group select:focus{outline:none; border-color:var(--accent);}
        .modal-actions{display:flex; gap:10px; margin-top:16px;}
        .modal-btn{flex:1; padding:10px 20px; border:0; border-radius:8px; font-weight:700; cursor:pointer; transition:all 0.3s; font-size:14px;}
        .modal-btn.primary{background:var(--accent); color:#fff;}
        .modal-btn.primary:hover{opacity:0.9;}
        .modal-btn.secondary{background:var(--muted); color:#fff;}
        .modal-btn.secondary:hover{opacity:0.9;}
        .form-row{display:flex; gap:12px;}
        .form-row .form-group{flex:1;}

        @media (max-width:900px){
            .hero{padding:20px 15px; min-height:auto;}
            .hero .inner{flex-direction:column; text-align:center; padding:20px 15px; gap:15px; background:#d35400;}
            .hero .left{flex:0 0 auto; margin-bottom:10px;}
            .hero .left img{max-width:180px; margin:0 auto;}
            .hero .right{width:100%;}
            .hero h2{font-size:1.3rem}
            .hero h1{font-size:1.8rem;}
            .locations{grid-template-columns:1fr; padding:0 15px;}
            .btn{padding:12px 24px; font-size:15px;}
        }
        
        @media (max-width:600px){
            header{padding:12px 15px; flex-direction:column; align-items:flex-start; gap:10px;}
            header .left-side{width:100%;}
            header h1{font-size:1.1rem;}
            nav{width:100%; justify-content:space-around; gap:16px;}
            .hero{padding:15px;}
            .hero .inner{padding:15px; gap:10px;}
            .hero .left img{max-width:150px;}
            .hero h1{font-size:1.5rem; margin-bottom:15px;}
            .hero h2{font-size:1.1rem;}
            .hero p{font-size:0.95rem;}
            .hero .cta{padding:10px 20px; font-size:14px;}
            section{padding:30px 15px;}
            .location-card{padding:15px;}
            .location-card h3{font-size:1rem;}
            .modal-content{width:95%; padding:20px; max-height:90vh; overflow-y:auto;}
            .profile-content{width:95%; padding:20px;}
            .form-group{margin-bottom:12px;}
            .form-group label{font-size:13px;}
            .form-group input, .form-group select, .form-group textarea{padding:10px; font-size:14px;}
            .modal-actions{flex-direction:column; gap:10px;}
            .modal-btn{width:100%; padding:12px;}
        }
    </style>
</head>
<body>

    <header>
        <div class="left-side">
            <img class="logo" src="IMAGENES/Pollo Siberiano.jpg" alt="Logo La Siberial">
            <div>
                <h1>La Siberial</h1>
                <p>Realiza tu pedido y recoge en tienda</p>
            </div>
        </div>
        <nav>
            <a href="index.html">Inicio</a>
            <a href="men√∫.html">Men√∫</a>
            <div class="profile-icon" id="profileIcon" title="Mi perfil">
                <i class="fas fa-user"></i>
            </div>
        </nav>
    </header>
    
    <section class="hero" aria-label="Hero ‚Äî Pide tu comida">
        <div class="inner">
            <div class="left">
                <img src="IMAGENES/Pollo Siberiano.jpg" alt="Mascota La Siberial">
            </div>
            <div class="right">
                <h2>PIDE TU COMIDA EN L√çNEA.</h2>
                <p class="lead">Selecciona de nuestro men√∫ y recoge en tienda. R√°pido y sencillo.</p>
                
            </div>
        </div>
    </section>

    <section class="about-section">
        <div class="about-box">
            <h2>Acerca de nosotros</h2>
            <div id="about-text">Somos apasionados por la cocina mexicana. Esto nos llevo a fusionar nuestra pasi√≥n y todo lo que amamos de nuestra regi√≥n en un lugar, uniendo lo real y lo fant√°stico. Convencidos que la comida es un momento para divertirse y disfrutar usamos ingredientes de calidad para que suceda la experiencia siberiana, la deliciosa explosi√≥n de sabores en el primer bocado.</div>
        </div>
    </section>
    
    <section class="map-section">
        <h2>Encuentra tu sucursal m√°s cercana</h2>
        <div class="map-container">
            <div class="locations">
                <div class="location-card" onclick="panToLocationFirst(25.8003005,-100.3173744)">
                    <h3>La Siberial</h3>
                    <p><i class="fas fa-map-marker-alt"></i>Escobedo, Nuevo Le√≥n</p>
                    <p><i class="fas fa-clock"></i>11:30 - 18:45</p>
                </div>
            </div>
            <iframe 
                class="map-frame-first"
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3592.099221517135!2d-100.31737442542371!3d25.800300477327635!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x86629394e0b02e83%3A0xa931c73a583d3aad!2sLa%20Siberial%20Escobedo!5e0!3m2!1ses-419!2smx!4v1763006965730!5m2!1ses-419!2smx"
                allowfullscreen=""
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade">
            </iframe>
        </div>
    </section>

    <section class="map-section">
        <h2>Otra sucursal disponible</h2>
        <div class="map-container">
            <div class="locations">
                <div class="location-card" onclick="panToLocationSecond(25.7544949,-100.2981505)">
                    <h3>La Siberial</h3>
                    <p><i class="fas fa-map-marker-alt"></i>San Nicol√°s, Nuevo Le√≥n</p>
                    <p><i class="fas fa-clock"></i>11:30 - 18:45</p>
                </div>
            </div>
            <iframe 
                class="map-frame-second"
                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3593.4863431236454!2d-100.29815053286089!3d25.754494862523845!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8662948f53cfffc1%3A0xd34562d044b03807!2sLa%20Siberial!5e0!3m2!1ses-419!2smx!4v1763006226239!5m2!1ses-419!2smx"
                allowfullscreen=""
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade">
            </iframe>
        </div>
    </section>

    <section class="reviews-section">
        <div class="reviews-container">
            <h2>Rese√±as de clientes</h2>
            <div id="reviews-list">
                
            </div>

            <form id="review-form" class="review-form">
                <input id="review-name" type="text" placeholder="Tu nombre" required>
                <select id="review-rating" required>
                    <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ 5</option>
                    <option value="4">‚òÖ‚òÖ‚òÖ‚òÖ 4</option>
                    <option value="3">‚òÖ‚òÖ‚òÖ 3</option>
                    <option value="2">‚òÖ‚òÖ 2</option>
                    <option value="1">‚òÖ 1</option>
                </select>
                <textarea id="review-comment" placeholder="Escribe tu rese√±a" required></textarea>
                <button type="submit">Enviar rese√±a</button>
            </form>
        </div>
    </section>

    <section class="delivery-section">
        <div class="delivery-container">
            <h2>¬øPrefieres que te llevemos la comida?</h2>
            <div class="delivery-content">
                <div class="delivery-info">
                    <i class="fas fa-phone-alt delivery-icon"></i>
                    <h3>Pedidos a domicilio</h3>
                    <p class="delivery-description">Cont√°ctanos por WhatsApp y te llevamos tu pedido directamente a tu puerta.</p>
                    <div class="phone-number">
                        <a href="https://wa.me/528125054847" target="_blank" style="color:inherit; text-decoration:none; display:inline-flex; align-items:center; gap:8px;">
                            <i class="fab fa-whatsapp"></i>
                            (+52) 81 2505 4847
                        </a>
                    </div>
                    <p class="delivery-note">Tiempo de entrega: 20-35 minutos</p>
                </div>
            </div>
        </div>
    </section>

    <div class="profile-modal" id="profileModal">
        <div class="profile-content">
            <h2>Mi Perfil</h2>
            <p style="color:var(--muted); margin-bottom:20px; text-align:center;">Guarda tus datos para hacer pedidos m√°s r√°pido</p>
            
            <form id="profileForm">
                <div class="form-group">
                    <label for="profileName">Nombre completo</label>
                    <input type="text" id="profileName" placeholder="Ingresa tu nombre">
                </div>
                
                <div class="form-group">
                    <label for="profilePhone">Tel√©fono</label>
                    <div class="phone-input-group">
                        <input type="text" id="profileCountryCode" class="country-code-input" placeholder="+52">
                        <input type="tel" id="profilePhone" class="phone-number-input" placeholder="Ingresa tu tel√©fono" pattern="[0-9]{10}">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="profileEmail">Correo electr√≥nico (opcional)</label>
                    <input type="email" id="profileEmail" placeholder="Ingresa tu correo">
                </div>
                
                <div class="form-group">
                    <label for="profileAddress">Direcci√≥n</label>
                    <input type="text" id="profileAddress" placeholder="Ingresa tu direcci√≥n">
                </div>
                
                <div class="form-group">
                    <label for="profileLocation">Sucursal preferida</label>
                    <select id="profileLocation">
                        <option value="">Selecciona una sucursal</option>
                        <option value="Sucursal Escobedo">Sucursal Escobedo</option>
                        <option value="Sucursal San Nicol√°s">Sucursal San Nicol√°s</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="profilePaymentMethod">M√©todo de pago preferido</label>
                    <select id="profilePaymentMethod">
                        <option value="">Selecciona un m√©todo de pago</option>
                        <option value="Efectivo">Efectivo</option>
                        <option value="Tarjeta">Tarjeta</option>
                    </select>
                </div>

                <div id="cardFields" style="display:none;">
                    <div class="form-group">
                        <label for="cardNumber">N√∫mero de tarjeta</label>
                        <input type="text" id="cardNumber" placeholder="---- ---- ---- ----" maxlength="19">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="cardExpiry">Fecha de expiraci√≥n</label>
                            <input type="text" id="cardExpiry" placeholder="MM/AA" maxlength="5">
                        </div>
                        <div class="form-group">
                            <label for="cardCVV">CVV</label>
                            <input type="text" id="cardCVV" placeholder="---" maxlength="4">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="cardName">Nombre en la tarjeta</label>
                        <input type="text" id="cardName" placeholder="Como aparece en tu tarjeta">
                    </div>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="modal-btn secondary" id="closeProfile">Cancelar</button>
                    <button type="button" class="modal-btn secondary" id="clearProfile">Borrar Datos</button>
                </div>
                
                <button type="submit" class="modal-btn primary" style="width:100%; margin-top:12px;">Guardar Datos</button>
            </form>
        </div>
    </div>

    <script>
        function panToLocationFirst(lat, lng) {
            const iframe = document.querySelector('.map-frame-first');
            iframe.src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3592.099221517135!2d-100.31737442542371!3d25.800300477327635!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x86629394e0b02e83%3A0xa931c73a583d3aad!2sLa%20Siberial%20Escobedo!5e0!3m2!1ses-419!2smx!4v1763006965730!5m2!1ses-419!2smx";
        }
        
        function panToLocationSecond(lat, lng) {
            const iframe = document.querySelector('.map-frame-second');
            iframe.src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3593.4864879118786!2d-100.30072102542559!3d25.7544900773565!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8662948f53cfffc1%3A0xd34562d044b03807!2sLa%20Siberial!5e0!3m2!1ses-419!2smx!4v1763007089975!5m2!1ses-419!2smx";
        }

        document.addEventListener('DOMContentLoaded', () => {
        
            const reviewsKey = 'ls_reviews_v1';
            const reviewsList = document.getElementById('reviews-list');
            const reviewForm = document.getElementById('review-form');
            const nameInput = document.getElementById('review-name');
            const ratingInput = document.getElementById('review-rating');
            const commentInput = document.getElementById('review-comment');

            function loadReviews() {
                const raw = localStorage.getItem(reviewsKey);
                return raw ? JSON.parse(raw) : [];
            }

            function saveReviews(arr) {
                localStorage.setItem(reviewsKey, JSON.stringify(arr));
            }

            function renderReviews() {
                const items = loadReviews();
                reviewsList.innerHTML = '';
                if (items.length === 0) {
                    reviewsList.innerHTML = '<p>No hay rese√±as todav√≠a ‚Äî s√© el primero en opinar.</p>';
                    return;
                }

                items.slice().reverse().forEach((r, idx) => {
                    const originalIndex = items.length - 1 - idx;
                    const div = document.createElement('div');
                    div.className = 'review-item';
                    div.innerHTML = `
                        <h4>${escapeHtml(r.name)} <span class="rating">${'‚òÖ'.repeat(r.rating)}${'‚òÜ'.repeat(5-r.rating)}</span></h4>
                        <p style="margin:6px 0 0">${escapeHtml(r.comment)}</p>
                        <button class="delete-review-btn" data-index="${originalIndex}" title="Eliminar rese√±a"><i class="fas fa-times"></i></button>
                    `;
                    reviewsList.appendChild(div);
                    
                    const deleteBtn = div.querySelector('.delete-review-btn');
                    deleteBtn.addEventListener('click', () => deleteReview(originalIndex));
                });
            }

            function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

            function deleteReview(index) {
                if (confirm('¬øEst√°s seguro de que quieres eliminar esta rese√±a?')) {
                    const arr = loadReviews();
                    arr.splice(index, 1);
                    saveReviews(arr);
                    renderReviews();
                }
            }

            reviewForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = nameInput.value.trim() || 'An√≥nimo';
                const rating = parseInt(ratingInput.value) || 5;
                const comment = commentInput.value.trim();
                if (!comment) return alert('Por favor escribe tu rese√±a.');

                const arr = loadReviews();
                arr.push({ name, rating, comment, created: Date.now() });
                saveReviews(arr);
                renderReviews();
                reviewForm.reset();
                nameInput.focus();
            });

            renderReviews();
        
        
        const profileIcon = document.getElementById('profileIcon');
        const profileModal = document.getElementById('profileModal');
        const profileForm = document.getElementById('profileForm');
        const closeProfile = document.getElementById('closeProfile');
        const clearProfile = document.getElementById('clearProfile');
        const profileKey = 'ls_user_profile';
        const profilePaymentMethod = document.getElementById('profilePaymentMethod');
        const cardFields = document.getElementById('cardFields');
        
        // Show/hide card fields based on payment method
        profilePaymentMethod.addEventListener('change', (e) => {
            if (e.target.value === 'Tarjeta') {
                cardFields.style.display = 'block';
            } else {
                cardFields.style.display = 'none';
                // Clear card fields when switching away from Tarjeta
                document.getElementById('cardNumber').value = '';
                document.getElementById('cardExpiry').value = '';
                document.getElementById('cardCVV').value = '';
                document.getElementById('cardName').value = '';
            }
        });
        
        // Format card number with spaces every 4 digits
        document.getElementById('cardNumber').addEventListener('input', (e) => {
            let value = e.target.value.replace(/\s/g, ''); // Remove spaces
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value; // Add space every 4 digits
            e.target.value = formattedValue;
        });
        
        // Format card expiry with auto-slash MM/YY
        document.getElementById('cardExpiry').addEventListener('input', (e) => {
            let value = e.target.value.replace(/\D/g, ''); // Remove non-digits
            if (value.length >= 2) {
                value = value.slice(0, 2) + '/' + value.slice(2, 4);
            }
            e.target.value = value;
        });
        
        // Allow only digits in CVV
        document.getElementById('cardCVV').addEventListener('input', (e) => {
            e.target.value = e.target.value.replace(/\D/g, '');
        });
        
        function loadProfile() {
            const raw = localStorage.getItem(profileKey);
            return raw ? JSON.parse(raw) : null;
        }
        
        function saveProfile(data) {
            localStorage.setItem(profileKey, JSON.stringify(data));
            updateProfileIcon();
        }
        
        function updateProfileIcon() {
            const profile = loadProfile();
            console.log('Actualizando icono de perfil:', profile);
            console.log('profileIcon element:', profileIcon);
            if (profile && (profile.name || profile.phone || profile.email || profile.location || profile.address || profile.paymentMethod)) {
                console.log('Agregando clase filled');
                profileIcon.classList.add('filled');
            } else {
                console.log('Removiendo clase filled');
                profileIcon.classList.remove('filled');
            }
        }
        
        profileIcon.addEventListener('click', () => {
            const profile = loadProfile();
            if (profile) {
                document.getElementById('profileName').value = profile.name || '';
                document.getElementById('profileCountryCode').value = profile.countryCode || '';
                document.getElementById('profilePhone').value = profile.phone || '';
                document.getElementById('profileEmail').value = profile.email || '';
                document.getElementById('profileLocation').value = profile.location || '';
                document.getElementById('profileAddress').value = profile.address || '';
                document.getElementById('profilePaymentMethod').value = profile.paymentMethod || '';
                
                // Load card data if exists
                document.getElementById('cardNumber').value = profile.cardNumber || '';
                document.getElementById('cardExpiry').value = profile.cardExpiry || '';
                document.getElementById('cardCVV').value = profile.cardCVV || '';
                document.getElementById('cardName').value = profile.cardName || '';
                
                // Show card fields if payment method is Tarjeta
                if (profile.paymentMethod === 'Tarjeta') {
                    cardFields.style.display = 'block';
                } else {
                    cardFields.style.display = 'none';
                }
                
                // Actualizar bandera si hay c√≥digo de pa√≠s
                if (profile.countryCode && window.updateCountryFlag) {
                    setTimeout(() => {
                        const countryInput = document.getElementById('profileCountryCode');
                        if (countryInput) {
                            window.updateCountryFlag(countryInput);
                        }
                    }, 50);
                }
            }
            profileModal.classList.add('active');
        });
        
        closeProfile.addEventListener('click', () => {
            profileModal.classList.remove('active');
            // Recargar los datos guardados para descartar cambios no guardados
            const profile = loadProfile();
            if (profile) {
                document.getElementById('profileName').value = profile.name || '';
                document.getElementById('profileCountryCode').value = profile.countryCode || '';
                document.getElementById('profilePhone').value = profile.phone || '';
                document.getElementById('profileEmail').value = profile.email || '';
                document.getElementById('profileLocation').value = profile.location || '';
                document.getElementById('profileAddress').value = profile.address || '';
                
                // Actualizar bandera si hay c√≥digo de pa√≠s
                if (profile.countryCode && window.updateCountryFlag) {
                    setTimeout(() => {
                        const countryInput = document.getElementById('profileCountryCode');
                        if (countryInput) {
                            window.updateCountryFlag(countryInput);
                        }
                    }, 50);
                }
            } else {
                profileForm.reset();
            }
        });
        
        profileForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Limpiar emoji de bandera del c√≥digo de pa√≠s antes de guardar
            let countryCodeValue = document.getElementById('profileCountryCode').value.trim();
            const emojiRegex = /[\u{1F1E6}-\u{1F1FF}]{2}/gu;
            countryCodeValue = countryCodeValue.replace(emojiRegex, '').trim();
            
            const profileData = {
                name: document.getElementById('profileName').value.trim(),
                countryCode: countryCodeValue,
                phone: document.getElementById('profilePhone').value.trim(),
                email: document.getElementById('profileEmail').value.trim(),
                location: document.getElementById('profileLocation').value,
                address: document.getElementById('profileAddress').value.trim(),
                paymentMethod: document.getElementById('profilePaymentMethod').value,
                cardNumber: document.getElementById('cardNumber').value.trim(),
                cardExpiry: document.getElementById('cardExpiry').value.trim(),
                cardCVV: document.getElementById('cardCVV').value.trim(),
                cardName: document.getElementById('cardName').value.trim()
            };
            
            if (!profileData.name && !profileData.phone && !profileData.email && !profileData.location && !profileData.address && !profileData.paymentMethod) {
                alert('Por favor completa al menos un campo para guardar tus datos');
                return;
            }
            
            // Si se llena el tel√©fono, el c√≥digo de pa√≠s es obligatorio
            if (profileData.phone && !profileData.countryCode) {
                alert('Por favor ingresa el c√≥digo de pa√≠s para tu tel√©fono');
                document.getElementById('profileCountryCode').focus();
                return;
            }
            
            // Si hay c√≥digo de pa√≠s, debe empezar con +
            if (profileData.countryCode && !profileData.countryCode.startsWith('+')) {
                alert('El c√≥digo de pa√≠s debe comenzar con +');
                document.getElementById('profileCountryCode').focus();
                return;
            }
            
            saveProfile(profileData);
            profileModal.classList.remove('active');
            alert('¬°Datos guardados correctamente!');
        });
        
        clearProfile.addEventListener('click', () => {
            const profile = loadProfile();
            if (!profile || (!profile.name && !profile.phone && !profile.email && !profile.location && !profile.address && !profile.paymentMethod)) {
                alert('No hay datos guardados para eliminar');
                return;
            }
            if (confirm('¬øEst√°s seguro de que quieres borrar tus datos guardados?')) {
                localStorage.removeItem(profileKey);
                profileForm.reset();
                updateProfileIcon();
                alert('Datos eliminados correctamente');
            }
        });
        
        updateProfileIcon();
        
        profileModal.onclick = (e) => {
            if (e.target === profileModal) {
                profileModal.classList.remove('active');
            }
        };
        
        // Definir funci√≥n global para actualizar banderas (se comparte con script.js)
        if (!window.updateCountryFlag) {
            window.updateCountryFlag = function(input) {
                const countryFlags = {
                    '+1': 'üá∫üá∏', '+7': 'üá∑üá∫', '+20': 'üá™üá¨', '+27': 'üáøüá¶', '+30': 'üá¨üá∑',
                    '+31': 'üá≥üá±', '+32': 'üáßüá™', '+33': 'üá´üá∑', '+34': 'üá™üá∏', '+36': 'üá≠üá∫',
                    '+39': 'üáÆüáπ', '+40': 'üá∑üá¥', '+41': 'üá®üá≠', '+43': 'üá¶üáπ', '+44': 'üá¨üáß',
                    '+45': 'üá©üá∞', '+46': 'üá∏üá™', '+47': 'üá≥üá¥', '+48': 'üáµüá±', '+49': 'üá©üá™',
                    '+51': 'üáµüá™', '+52': 'üá≤üáΩ', '+53': 'üá®üá∫', '+54': 'üá¶üá∑', '+55': 'üáßüá∑',
                    '+56': 'üá®üá±', '+57': 'üá®üá¥', '+58': 'üáªüá™', '+60': 'üá≤üáæ', '+61': 'üá¶üá∫',
                    '+62': 'üáÆüá©', '+63': 'üáµüá≠', '+64': 'üá≥üáø', '+65': 'üá∏üá¨', '+66': 'üáπüá≠',
                    '+81': 'üáØüáµ', '+82': 'üá∞üá∑', '+84': 'üáªüá≥', '+86': 'üá®üá≥', '+90': 'üáπüá∑',
                    '+91': 'üáÆüá≥', '+92': 'üáµüá∞', '+93': 'üá¶üá´', '+94': 'üá±üá∞', '+95': 'üá≤üá≤',
                    '+98': 'üáÆüá∑', '+212': 'üá≤üá¶', '+213': 'üá©üáø', '+216': 'üáπüá≥', '+218': 'üá±üáæ',
                    '+220': 'üá¨üá≤', '+221': 'üá∏üá≥', '+222': 'üá≤üá∑', '+223': 'üá≤üá±', '+224': 'üá¨üá≥',
                    '+225': 'üá®üáÆ', '+226': 'üáßüá´', '+227': 'üá≥üá™', '+228': 'üáπüá¨', '+229': 'üáßüáØ',
                    '+230': 'üá≤üá∫', '+231': 'üá±üá∑', '+232': 'üá∏üá±', '+233': 'üá¨üá≠', '+234': 'üá≥üá¨',
                    '+235': 'üáπüá©', '+236': 'üá®üá´', '+237': 'üá®üá≤', '+238': 'üá®üáª', '+239': 'üá∏üáπ',
                    '+240': 'üá¨üá∂', '+241': 'üá¨üá¶', '+242': 'üá®üá¨', '+243': 'üá®üá©', '+244': 'üá¶üá¥',
                    '+245': 'üá¨üáº', '+246': 'üáÆüá¥', '+248': 'üá∏üá®', '+249': 'üá∏üá©', '+250': 'üá∑üáº',
                    '+251': 'üá™üáπ', '+252': 'üá∏üá¥', '+253': 'üá©üáØ', '+254': 'üá∞üá™', '+255': 'üáπüáø',
                    '+256': 'üá∫üá¨', '+257': 'üáßüáÆ', '+258': 'üá≤üáø', '+260': 'üáøüá≤', '+261': 'üá≤üá¨',
                    '+262': 'üá∑üá™', '+263': 'üáøüáº', '+264': 'üá≥üá¶', '+265': 'üá≤üáº', '+266': 'üá±üá∏',
                    '+267': 'üáßüáº', '+268': 'üá∏üáø', '+269': 'üá∞üá≤', '+290': 'üá∏üá≠', '+291': 'üá™üá∑',
                    '+297': 'üá¶üáº', '+298': 'üá´üá¥', '+299': 'üá¨üá±', '+350': 'üá¨üáÆ', '+351': 'üáµüáπ',
                    '+352': 'üá±üá∫', '+353': 'üáÆüá™', '+354': 'üáÆüá∏', '+355': 'üá¶üá±', '+356': 'üá≤üáπ',
                    '+357': 'üá®üáæ', '+358': 'üá´üáÆ', '+359': 'üáßüá¨', '+370': 'üá±üáπ', '+371': 'üá±üáª',
                    '+372': 'üá™üá™', '+373': 'üá≤üá©', '+374': 'üá¶üá≤', '+375': 'üáßüáæ', '+376': 'üá¶üá©',
                    '+377': 'üá≤üá®', '+378': 'üá∏üá≤', '+380': 'üá∫üá¶', '+381': 'üá∑üá∏', '+382': 'üá≤üá™',
                    '+383': 'üáΩüá∞', '+385': 'üá≠üá∑', '+386': 'üá∏üáÆ', '+387': 'üáßüá¶', '+389': 'üá≤üá∞',
                    '+420': 'üá®üáø', '+421': 'üá∏üá∞', '+423': 'üá±üáÆ', '+500': 'üá´üá∞', '+501': 'üáßüáø',
                    '+502': 'üá¨üáπ', '+503': 'üá∏üáª', '+504': 'üá≠üá≥', '+505': 'üá≥üáÆ', '+506': 'üá®üá∑',
                    '+507': 'üáµüá¶', '+508': 'üáµüá≤', '+509': 'üá≠üáπ', '+590': 'üá¨üáµ', '+591': 'üáßüá¥',
                    '+592': 'üá¨üáæ', '+593': 'üá™üá®', '+594': 'üá¨üá´', '+595': 'üáµüáæ', '+596': 'üá≤üá∂',
                    '+597': 'üá∏üá∑', '+598': 'üá∫üáæ', '+599': 'üá®üáº', '+670': 'üáπüá±', '+672': 'üá≥üá´',
                    '+673': 'üáßüá≥', '+674': 'üá≥üá∑', '+675': 'üáµüá¨', '+676': 'üáπüá¥', '+677': 'üá∏üáß',
                    '+678': 'üáªüá∫', '+679': 'üá´üáØ', '+680': 'üáµüáº', '+681': 'üáºüá´', '+682': 'üá®üá∞',
                    '+683': 'üá≥üá∫', '+685': 'üáºüá∏', '+686': 'üá∞üáÆ', '+687': 'üá≥üá®', '+688': 'üáπüáª',
                    '+689': 'üáµüá´', '+690': 'üáπüá∞', '+691': 'üá´üá≤', '+692': 'üá≤üá≠', '+850': 'üá∞üáµ',
                    '+852': 'üá≠üá∞', '+853': 'üá≤üá¥', '+855': 'üá∞üá≠', '+856': 'üá±üá¶', '+880': 'üáßüá©',
                    '+886': 'üáπüáº', '+960': 'üá≤üáª', '+961': 'üá±üáß', '+962': 'üáØüá¥', '+963': 'üá∏üáæ',
                    '+964': 'üáÆüá∂', '+965': 'üá∞üáº', '+966': 'üá∏üá¶', '+967': 'üáæüá™', '+968': 'üá¥üá≤',
                    '+970': 'üáµüá∏', '+971': 'üá¶üá™', '+972': 'üáÆüá±', '+973': 'üáßüá≠', '+974': 'üá∂üá¶',
                    '+975': 'üáßüáπ', '+976': 'üá≤üá≥', '+977': 'üá≥üáµ', '+992': 'üáπüáØ', '+993': 'üáπüá≤',
                    '+994': 'üá¶üáø', '+995': 'üá¨üá™', '+996': 'üá∞üá¨', '+998': 'üá∫üáø'
                };
                
                let value = input.value.trim();
                
                // Remover bandera existente si la hay
                const emojiRegex = /[\u{1F1E6}-\u{1F1FF}]{2}/gu;
                value = value.replace(emojiRegex, '').trim();
                
                // Si el usuario empieza a escribir y no tiene +, agregarlo autom√°ticamente
                if (value.length > 0 && !value.startsWith('+')) {
                    value = '+' + value;
                }
                
                // Buscar el c√≥digo de pa√≠s en el valor
                const codeMatch = value.match(/\+\d{1,4}/);
                if (codeMatch) {
                    const code = codeMatch[0];
                    const flag = countryFlags[code];
                    
                    // Solo agregar la bandera si existe en el diccionario
                    if (flag) {
                        input.value = flag + ' ' + value;
                    } else {
                        input.value = value;
                    }
                } else if (value.length > 0) {
                    // Si hay texto pero no coincide con el patr√≥n, mantener el valor
                    input.value = value;
                }
            };
        }
        
        // Actualizar bandera seg√∫n c√≥digo de pa√≠s
        const profileCountryCodeInput = document.getElementById('profileCountryCode');
        if (profileCountryCodeInput) {
            profileCountryCodeInput.addEventListener('input', function() {
                window.updateCountryFlag(this);
            });
        }
        });
    </script>
</body>
</html>
